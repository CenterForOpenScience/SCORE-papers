---
title: "SCORE Targets"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 6
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
library(targets)
library(readr)
library(googledrive)
library(googlesheets4)
# Silly workaround to get renv to store these packages
library(hashids)
library(usethis)
library(visNetwork)
tar_unscript()
```

The R package `targets` is a [make](https://www.gnu.org/software/make/)-like tool for reproducibly running the code that generates project products, such as analytic datasets, models, and figures. 

Rendering this file using `rmarkdown::render("targets.Rmd")` executes a series of functions in the correct order to build target files (also known as "targets", e.g., analytic datasets, figures) from source files (e.g., raw data). It also documents the dependencies of the target file, including all files (whether source files or other targets) which are used as inputs to the commands in the functions used to generate the target file.

# Globals

We first define the global options and source functions used to generate target files.

```{targets globals, tar_globals = TRUE}
options(tidyverse.quiet = TRUE,
        # Gmail authorization for accessing sheets
        # Set google_oauth_email="youremail@cos.io" in your .Renviron file 
        # to use this document without changing the code.
        gargle_oauth_email = Sys.getenv("google_oauth_email"),
        scipen = 999)

googledrive::drive_auth()
googlesheets4::gs4_auth()

tar_option_set(
  # Packages the targets need to run
  packages = c("BayesFactor",
               "BayesRep",
               "BFF",
               "dplyr",
               "effectsize",
               "ggExtra",
               "glue",
               "googlesheets4",
               "googledrive",
               "here",
               "kableExtra",
               "lubridate",
               "metaBMA",
               "metafor",
               "osfr",
               "purrr",
               "pwr",
               "readr",
               "ReplicationSuccess",
               "sjPlot",
               "stringr",
               "tibble",
               "tidyr") 
)

# All functions used are found in the folder named "pipeline"
tar_source(files = "pipeline")

```

# Targets

Most raw data files will have three targets associated with them - one for their ID on Google Drive or OSF, one for the modification date of the file, and one that actually represents the data loaded into R. The modification date targets are set to run every time `tar_make()` is called so that the file is pulled again if it is ever updated online. 

## Publication-level Metadata

``` {targets publications}
list(
  # Raw ----
  # publications.csv
  # Journal-level data for all articles
  tar_target(publications_file,
             "1fXHxIcsFjiAgmydESNkgLjx36dTCSC34"),
  tar_target(publications_moddate,
             get_google_mod_date(publications_file),
             cue = tar_cue("always")),
  tar_target(publications_raw,
             read_google_csv(publications_file,
                             publications_moddate)),
  
  # Publications Changelog
  tar_target(pub_changelog_file,
             "1CM0wbYnRvBMIyDVFzvwxw3GVH_uRJ3BXRtdwlxTmS1A"),
  tar_target(pub_changelog_moddate,
             get_google_mod_date(pub_changelog_file),
             cue = tar_cue("always")),
  tar_target(pub_changelog,
             load_changelog(pub_changelog_file,
                            pub_changelog_moddate)),
  
  # SCORE TOP factor scoring sheet
  # TOP factor info
  tar_target(top_factor_file,
             "1hDpl8wHE7RRh9rksO1izx-hRtnjaW9u471yV0scHBnA"),
  tar_target(top_factor_moddate,
             get_google_mod_date(top_factor_file),
             cue = tar_cue("always")),
  tar_target(top_factor,
             read_google_sheet(top_factor_file,
                               top_factor_moddate,
                               sheet = "From TopFactor website")),
  
  # Processed ----
  ## Update and Transform ----
  tar_target(pubs_updated,
             transform_pubs(publications_raw,
                            pub_changelog)),
  
  ## Merge ----
  # Merge publication data with top factor information
  tar_target(publications,
             left_join(pubs_updated,
                       top_factor,
                       by = join_by(publication_standard == Journal)))
  
)
```

## Paper-level Metadata

```{targets papers}
list(
  # Raw ----
  # all_metadata_filled.tsv
  # Data about the papers from both Web of Science and CrossRef
  tar_target(all_metadata_filled_file,
             "1W-sNolZQegujz82TU2RKe0tfCvofrhm1"),
  tar_target(all_metadata_filled_moddate,
             get_google_mod_date(all_metadata_filled_file),
             cue = tar_cue("always")),
  tar_target(all_metadata_filled,
             read_google_tsv(all_metadata_filled_file,
                             all_metadata_filled_moddate)),

  # covid_metadata.tsv
  # Data about COVID papers
  tar_target(covid_metadata_file,
             "1coSF-yytg1uNvboJ90qWWjrlJMGzjfMu"),
  tar_target(covid_metadata_moddate,
             get_google_mod_date(covid_metadata_file),
             cue = tar_cue("always")),
  tar_target(covid_metadata_raw,
             read_google_tsv(covid_metadata_file,
                             covid_metadata_moddate)),
  
  # status.csv
  # Canonical source for sub-samples of the data
  # Does not contain COVID papers
  tar_target(status_file,
             "1lETiML-WFVGK1MS0ELCZejIaXnDDXYWh"),
  tar_target(status_moddate,
             get_google_mod_date(status_file),
             cue = tar_cue("always")),
  tar_target(status,
             read_google_csv(status_file,
                             status_moddate)),
  
  ## Raw data with unknown use ----
  # CR_metadata_prepool.csv
  tar_target(CR_metadata_prepool_file,
             "1FnmZMEYiWBhAj0THZvMetdWzuohraPy3"),
  tar_target(CR_metadata_prepool_moddate,
             get_google_mod_date(CR_metadata_prepool_file),
             cue = tar_cue("always")),
  tar_target(CR_metadata_prepool,
             read_google_csv(CR_metadata_prepool_file,
                             CR_metadata_prepool_moddate)),
  
  # p2_id_key.csv
  # Links cannonical paper ID to the IDs used by other teams
  # Does not include COVID papers
  tar_target(p2_id_key_file,
             "1E9af5ncbY2gm7CvHjrWVJt4x_F-ZbyS1"),
  tar_target(p2_id_key_moddate,
             get_google_mod_date(p2_id_key_file),
             cue = tar_cue("always")),
  tar_target(p2_id_key,
             read_google_csv(p2_id_key_file,
                             p2_id_key_moddate)),
  
  # Processed ----
  ## Transform ----
  # Metadata for covid papers was collected separately from other papers
  # Reconcile differences for merging
  tar_target(covid_metadata,
             transform_covid_metadata(covid_metadata_raw)),
  
  tar_target(non_covid_metadata,
             transform_paper_metadata(all_metadata_filled, status)),
  
  ## Merge ----
  tar_target(paper_metadata,
             merge_paper_metadata(non_covid_metadata,
                                  covid_metadata,
                                  publications))
  
)
```

## Original Articles

### Claims

```{targets claims}
list(
  # Raw ----
  # tagtable_covid_p1.tsv
  # Claims extracted from phase 1 COVID papers with canonical paper IDs
  # Needed in orig to denote covid papers, and for IDs in PR
  tar_target(tagtable_covid_p1_file,
             "1lc2P9N2RPXR2YZB6_Zh1E8eXNiRdm50t"),
  tar_target(tagtable_covid_p1_moddate,
             get_google_mod_date(tagtable_covid_p1_file),
             cue = tar_cue("always")),
  tar_target(tagtable_covid_p1,
             read_google_tsv(tagtable_covid_p1_file,
                             tagtable_covid_p1_moddate)),
  
  # stitched_claims.tsv
  # All bushel claims with canonical paper IDs
  tar_target(stitched_claims_file,
             "1v_ci1nEomtT1ZJKaOeJXqauCsmQJG40b"),
  tar_target(stitched_claims_moddate,
             get_google_mod_date(stitched_claims_file),
             cue = tar_cue("always")),
  tar_target(stitched_claims,
             read_google_tsv(stitched_claims_file,
                             stitched_claims_moddate)),
  
  # P1 claims
  tar_target(tagtable_p1_file,
             "1NmhTX53-SWsMpIbgZpm2bWm1SzRq071F"),
  tar_target(tagtable_p1_moddate,
             get_google_mod_date(tagtable_p1_file),
             cue = tar_cue("always")),
  tar_target(tagtable_p1,
             read_google_tsv(tagtable_p1_file,
                             tagtable_p1_moddate)),
  
  # P2 claims
  tar_target(tagtable_p2_CES_file,
             "1Lr2SXHO261GaifluZSZ1kl7OjjbnHrqe"),
  tar_target(tagtable_p2_CES_moddate,
             get_google_mod_date(tagtable_p2_CES_file),
             cue = tar_cue("always")),
  tar_target(tagtable_p2_CES,
             read_google_tsv(tagtable_p2_CES_file,
                             tagtable_p2_CES_moddate)),
  
  # covid_ta2.csv
  # Claims extracted from phase 1 COVID papers with paper IDs for TA2
  tar_target(covid_ta2_osf,
             "yr3w8"),
  tar_target(covid_ta2_mod_date, 
             get_osf_mod_date(covid_ta2_osf),
             cue = tar_cue("always")), 
  tar_target(covid_ta2,
             load_osf_csv(covid_ta2_osf,
                          covid_ta2_mod_date)),
  
  # Complex Bushel
  tar_target(complex_bushel_gsheet,
             "1hlcidipFCVV4WlGyCT6cMDFjyQsGA8CCoGUFASuQAhY"),
  tar_target(complex_bushel_mod_date,
             get_google_mod_date(complex_bushel_gsheet),
             cue = tar_cue("always")),
  tar_target(complex_bushel,
             read_google_sheet(complex_bushel_gsheet,
                               complex_bushel_mod_date)),
  
  # # SCORE_csv.csv
  # # Phase 1 Extracted Claims
  # # Remove?
  # tar_target(SCORE_csv_osf,
  #            "9qt6d"),
  # tar_target(SCORE_csv_mod_date, 
  #            get_osf_mod_date(SCORE_csv_osf),
  #            cue = tar_cue("always")), 
  # tar_target(SCORE_csv,
  #            load_osf_csv(SCORE_csv_osf,
  #                         SCORE_csv_mod_date)),
  
  # # SCORE_CVD2.csv
  # # Phase 2 extracted claims with paper IDs for TA2
  # # Remove?
  # tar_target(SCORE_CVD2_osf,
  #            "du5mt"),
  # tar_target(SCORE_CVD2_mod_date, 
  #            get_osf_mod_date(SCORE_CVD2_osf),
  #            cue = tar_cue("always")), 
  # tar_target(SCORE_CVD2,
  #            load_osf_csv(SCORE_CVD2_osf,
  #                         SCORE_CVD2_mod_date)),
  
  # Processed ----
  tar_target(extracted_claims,
             merge_claims(tagtable_p1,
                          tagtable_covid_p1,
                          tagtable_p2_CES,
                          stitched_claims,
                          complex_bushel,
                          status,
                          covid_metadata))
  
)
```

### Original Variables
```{targets original-variables}
list(
  # Raw ----
  # orig_statistics_dataset_p1.tsv
  tar_target(orig_statistics_p1_file,
             "1TLm9loSU8n3pSRoz0ugekJ6VfSiS792p"),
  tar_target(orig_statistics_p1_moddate,
             get_google_mod_date(orig_statistics_p1_file),
             cue = tar_cue("always")),
  tar_target(
    orig_statistics_dataset_p1,
    read_google_tsv(
      orig_statistics_p1_file,
      orig_statistics_p1_moddate,
      col_types = list(
        # All load in by default as character, so manually set to double
        original_statistic_value_reported = col_double(),
        original_statistic_df1_reported = col_double(),
        original_statistic_df2_reported = col_double(),
        # There is a weird data corruption in this field that throws a warning, 
        # but it gets fixed in the changelog:
        original_coefficient_value_reported = col_double(),
        original_coefficient_se_reported = col_double(),
        original_effect_size_value_reported = col_double(),
        original_analytic_sample_size_value_reference = col_double(),
        original_statistic_value_reference = col_double(),
        original_statistic_df1_reference = col_double(),
        original_statistic_df2_reference = col_double(),
        original_coefficient_se_reference = col_double(),
        original_p_value_value_reference = col_double(),
        original_effect_size_value_reference = col_double(),
        rr_threshold_analytic_sample_size = col_double(),
        rr_stage1_analytic_sample_size = col_double(),
        rr_stage2_analytic_sample_size = col_double(),
        original_total_model_parameters = col_double()
      )
    )
  ),
  
  # orig_statistics_manual_dataset.tsv
  tar_target(orig_statistics_manual_file,
             "1B8-fTy_wpCcwHJAGt8FZKIuIoeHeE0T6"),
  tar_target(orig_statistics_manual_moddate,
             get_google_mod_date(orig_statistics_manual_file),
             cue = tar_cue("always")),
  tar_target(
    orig_statistics_manual_data_entry,
    read_google_tsv(
      orig_statistics_manual_file,
      orig_statistics_manual_moddate,
      col_types = list(
        # originally: logical
        original_statistic_type_reported = col_character(),
        original_statistic_type_reference = col_character()
      )
    )
  ),
  
  # original_inftest_dataset.tsv
  tar_target(original_inftest_file,
             "1goGxpXYcpCWNxBa1HE1oEEifVFlUOix7"),
  tar_target(original_inftest_moddate,
             get_google_mod_date(original_inftest_file),
             cue = tar_cue("always")),
  tar_target(original_inftest_dataset,
             read_google_tsv(original_inftest_file,
                             original_inftest_moddate)),
  
  # orig_input_changelog (Google Sheet)
  tar_target(orig_input_changelog_file,
             "1M8H_76ajxwdhVuuSyIo18BxRrJbMF3hXpAkzYY39g2k"),
  tar_target(orig_input_changelog_moddate,
             get_google_mod_date(orig_input_changelog_file),
             cue = tar_cue("always")),
  tar_target(orig_input_changelog,
             load_changelog(orig_input_changelog_file,
                            orig_input_changelog_moddate)),
  
  # SCORE-P2-103: Original variables coding form (Responses)
  tar_target(orig_vars_qa_gsheet,
             "1_rgG3r318tpsakc8wSA0dMAYJ--pkiybVq5s9dfek6M"),
  tar_target(orig_vars_qa_mod_date,
             get_google_mod_date(orig_vars_qa_gsheet),
             cue = tar_cue("always")), 
  tar_target(orig_vars_qa,
             read_google_sheet(orig_vars_qa_gsheet,
                               orig_vars_qa_mod_date)),
  
  # Added SCORE variables - Gsheet
  tar_target(effectsize_gsheet,
             "1tS_M7RcyWIkXlDf13TqSfGdvWXBL_m9lgcV8ML34Jdo"),
  tar_target(effectsize_moddate,
             get_google_mod_date(effectsize_gsheet),
             cue = tar_cue("always")),
  
  # Added SCORE variables - Original
  tar_target(effectsize_orig,
             read_google_sheet(effectsize_gsheet,
                               effectsize_moddate,
                               sheet = "original")),
  
  # orig_statistics_output_p2.tsv
  tar_target(orig_statistics_output_p2_osf,
             "hk63r"),
  tar_target(orig_statistics_output_p2_mod_date, 
             get_osf_mod_date(orig_statistics_output_p2_osf),
             cue = tar_cue("always")), 
  tar_target(
    orig_statistics_output_p2,
    load_osf_tsv(orig_statistics_output_p2_osf,
                 orig_statistics_output_p2_mod_date,
                 quote = "\\\"")
  ),
  
  # Processed ----
  ## Merge ----
  tar_target(orig_merged,
             merge_orig_input(orig_statistics_dataset_p1,
                              original_inftest_dataset,
                              orig_statistics_manual_data_entry,
                              orig_vars_qa,
                              tagtable_covid_p1,
                              orig_cases)),
  ## Update ----
  tar_target(orig_updated,
             update_orig_input(orig_merged,
                               orig_input_changelog)),
  
  ## Refine ----
  tar_target(orig_dataset,
             export_orig(orig_updated,
                         orig_statistics_output_p2)),
  
  tar_target(orig_outcomes,
             create_ov_analytic(orig_dataset,
                                complex_bushel,
                                effectsize_orig,
                                effectsize_outcome,
                                repli_export))
  
)
```

### Replications and Reproductions

```{targets repli-repro}
list(

  # Replication Cases - RR Projects
  tar_target(repli_cases_gsheet,
             "1y57RNOH96x8dXYc8gxBbCQOmuaMVOoaD0KgJYfoITmg"),
  tar_target(repli_cases_moddate,
             get_google_mod_date(repli_cases_gsheet),
             cue = tar_cue("always")),
  tar_target(repli_cases_projects,
             read_google_sheet(repli_cases_gsheet,
                               repli_cases_moddate,
                               sheet = "rr_projects")),
  
  tar_target(replication_cases,
             read_google_sheet(repli_cases_gsheet,
                               repli_cases_moddate,
                               sheet = "repli_export")),
  
  tar_target(reproduction_cases,
             read_google_sheet(repli_cases_gsheet,
                               repli_cases_moddate,
                               sheet = "repro_export")),
  
  tar_target(orig_cases,
             read_google_sheet(repli_cases_gsheet,
                               repli_cases_moddate,
                               sheet = "orig_dataset")),
  
  # File: SCORE-P2-081: Variable form - replications (Responses)
  tar_target(replication_qa_gsheet,
             "1Cs7iFLA29JwVDfp8DY0ZIaTlRTTnK0KsFSudLDHxjFQ"),
  tar_target(replication_qa_mod_date,
             get_google_mod_date(replication_qa_gsheet)),
  tar_target(replication_qa_raw,
             read_google_sheet(replication_qa_gsheet,
                               replication_qa_mod_date),
             cue = tar_cue("always")),
  
  # File: SCORE-P2-113: Variable form - reproductions (Responses)
  tar_target(reproduction_qa_gsheet,
             "1vCVHLymiT-IcVGvWH_a3cJ4dfhjrf8lvmi4qe24LuZs"),
  tar_target(reproduction_qa_moddate,
             get_google_mod_date(reproduction_qa_gsheet),
             cue = tar_cue("always")),
  tar_target(reproduction_qa,
             read_google_sheet(reproduction_qa_gsheet,
                               reproduction_qa_moddate),
             cue = tar_cue("always")),
  
  # File: SCORE-P2-097: Prereg check-in form (Reproduction) (Responses)
  tar_target(prereg_checkin_repro_gsheet,
             "11UCF2cuoBwLfJrQZC7AoWqG7EjCBoxV_GC-aFMsy6u4"),
  tar_target(prereg_checkin_repro_moddate,
             get_google_mod_date(prereg_checkin_repro_gsheet),
             cue = tar_cue("always")),
  tar_target(prereg_checkin_repro,
             read_google_sheet(prereg_checkin_repro_gsheet,
                               prereg_checkin_repro_moddate),
             cue = tar_cue("always")),
  
  # File: repro_vor
  # Reproduction Version of Record
  tar_target(repro_vor_gsheet,
             "1jxgJQDIiKOOodtZR9bTLoBxZya4KlGexhwi2SekbBU0"),
  tar_target(repro_vor_moddate,
             get_google_mod_date(repro_vor_gsheet),
             cue = tar_cue("always")),
  tar_target(repro_vor,
             read_google_sheet(repro_vor_gsheet,
                               repro_vor_moddate,
                               sheet = "repro_version_of_record")),
  # rr_projects.csv
  tar_target(rr_projects_file,
             "11paXdFzhCmz8ywFomUhZ6qrfp1wlKLIx"),
  tar_target(rr_projects_moddate,
             get_google_mod_date(rr_projects_file),
             cue = tar_cue("always")),
  tar_target(rr_projects_raw,
             read_google_csv(rr_projects_file,
                             rr_projects_moddate)),
  
  # Replication case exclusions
  tar_target(repli_case_exclusions_gsheet,
             "17cyjatTcqN36_vZ_IvWtcr4n2Ep-KlKJ-PS3K-q6wdU"),
  tar_target(repli_case_exclusions_mod_date,
             get_google_mod_date(repli_case_exclusions_gsheet),
             cue = tar_cue("always")), 
  tar_target(repli_case_exclusions,
             read_google_sheet(repli_case_exclusions_gsheet,
                               repli_case_exclusions_mod_date)),
  
  ## changes/ ----
  # repli_input_changelog (Google Sheet)
  tar_target(repli_input_changelog_file,
             "1jbkVYHLinIN9zXBuPTok26bHjDt69-7D_Z7yVOin3mM"),
  tar_target(repli_input_changelog_moddate,
             get_google_mod_date(repli_input_changelog_file),
             cue = tar_cue("always")),
  tar_target(repli_input_changelog,
             load_changelog(repli_input_changelog_file,
                            repli_input_changelog_moddate)),
  
  # p2_repro_input_changelog (Google Sheet)
  tar_target(p2_repro_input_changelog_file,
             "1c2i_k-RMzTWAC7RD6cqhheToihtS8_C5r5powvRuMDE"),
  tar_target(p2_repro_input_changelog_moddate,
             get_google_mod_date(repli_input_changelog_file),
             cue = tar_cue("always")),
  tar_target(p2_repro_input_changelog,
             load_changelog(p2_repro_input_changelog_file,
                            p2_repro_input_changelog_moddate)),
  
  # rr_attempts_minted_changelog (Google Sheet)
  tar_target(rr_attempts_minted_changelog_file,
             "1rlVy9A4jBwQzpxTH4my4FUWaZkq7388YfpRmQOZWihw"),
  tar_target(rr_attempts_minted_changelog_moddate,
             get_google_mod_date(rr_attempts_minted_changelog_file),
             cue = tar_cue("always")),
  tar_target(rr_attempts_minted_changelog,
             load_changelog(rr_attempts_minted_changelog_file,
                            rr_attempts_minted_changelog_moddate)),
  
  # repro_supplement_changelog (Google Sheet)
  tar_target(repro_supplement_changelog_file,
             "1OzOpJCJCy5OPYISk1UR5tI0ehNaou-ykAeD7GPZ99ug"),
  tar_target(repro_supplement_changelog_moddate,
             get_google_mod_date(repro_supplement_changelog_file),
             cue = tar_cue("always")),
  tar_target(repro_supplement_changelog,
             load_changelog(repro_supplement_changelog_file,
                            repro_supplement_changelog_moddate)),
  
  ## checkins/ ----
  # rr_reporting_checkin.tsv
  tar_target(rr_reporting_checkin_file,
             "1jB97FM-desZatqabwBVMPrSYk0qXWFjM"),
  tar_target(rr_reporting_checkin_moddate,
             get_google_mod_date(rr_reporting_checkin_file),
             cue = tar_cue("always")),
  tar_target(rr_reporting_checkin,
             read_google_tsv(rr_reporting_checkin_file,
                             rr_reporting_checkin_moddate)),
  
  ## codebooks/ ----
  # p2_repli_vf.csv
  tar_target(p2_repli_vf_file,
             "1fwWX7ebwhBF9IYt2dQyhEByBnRNavOmj"),
  tar_target(p2_repli_vf_moddate,
             get_google_mod_date(p2_repli_vf_file),
             cue = tar_cue("always")),
  tar_target(p2_repli_vf,
             read_google_csv(p2_repli_vf_file,
                             p2_repli_vf_moddate)),

  
  ## outcomes/ ----
  # rr_outcomes_dataset_p1.tsv
  tar_target(rr_outcomes_dataset_p1_file,
             "113CSsObKagvQToj-inv4bO3KaS5zif6D"),
  tar_target(rr_outcomes_dataset_p1_moddate,
             get_google_mod_date(rr_outcomes_dataset_p1_file),
             cue = tar_cue("always")),
  tar_target(rr_outcomes_dataset_p1,
             read_google_tsv(rr_outcomes_dataset_p1_file,
                             rr_outcomes_dataset_p1_moddate)),
  
  ## project_minting/ ----
  # rr_attempts_minted.csv
  # Status and tracking for rr projects
  tar_target(rr_attempts_minted_file,
             "1aHuTwRVeqADWVC4Lxq5n3B4ebbSa9Mqc"),
  tar_target(rr_attempts_minted_moddate,
             get_google_mod_date(rr_attempts_minted_file),
             cue = tar_cue("always")),
  tar_target(rr_attempts_minted_raw,
             read_google_csv(rr_attempts_minted_file,
                             rr_attempts_minted_moddate))
  
)
```

#### SCORE

Data files from the [SCORE](https://drive.google.com/drive/folders/0AHots-bNz56yUk9PVA) Google Drive.

```{targets raw-score}
list(

  # Added SCORE variables - Replication
  tar_target(effectsize_repli,
             read_google_sheet(effectsize_gsheet,
                               effectsize_moddate,
                               sheet = "replication")),
  
  
  
  # Added SCORE variables - Outcomes
  tar_target(effectsize_outcome,
             read_google_sheet(effectsize_gsheet,
                               effectsize_moddate,
                               sheet = "outcomes"))
)
```

### OSF Projects



#### SCORE-Phase 1 RR and original article analyses

Data from the OSF Project [SCORE-Phase 1 RR and original article analyses](https://osf.io/3fsbm/). Output of analysis from collaborators at Tilburg University. 

```{targets raw-phase1-rr}
list(
  
  
  # rr_statistics_output_p2.txt
  tar_target(rr_statistics_output_p2_osf,
             "6u7hc"),
  tar_target(rr_statistics_output_p2_mod_date, 
             get_osf_mod_date(rr_statistics_output_p2_osf),
             cue = tar_cue("always")), 
  tar_target(
    rr_statistics_output_p2,
    load_rr_statistics_output_p2(rr_statistics_output_p2_osf,
                                 rr_statistics_output_p2_mod_date)
  )
)
```

### Helpers

The `valid_ids` object is used to check that files being loaded in the following sections only use valid IDs. Also load in `rr_projects.csv` here for convenience since it is used to generate the list of valid IDs. 

The `id_key` object is used to match up the canonical paper IDs with the IDs assigned to papers for TA2 and TA3. 

```{targets helpers}
list(

  tar_target(rr_projects,
             extend_rr_projects(rr_projects_raw,
                                repli_cases_projects)),

  # tar_target(valid_ids,
  #            create_id_list(status,
  #                           tagtable_covid_p1,
  #                           finalized_claim4_table,
  #                           rr_projects)),
  # Temp rr project list
  tar_target(all_rr_attempts_gsheet,
             "13YmuK4UxMEreDNHY4WfjEqDHOi2Htlvwh4wxwbVK25U"),
  tar_target(all_rr_attempts_moddate,
             get_google_mod_date(all_rr_attempts_gsheet),
             cue = tar_cue("always")),
  tar_target(all_rr_attempts,
             read_google_sheet(all_rr_attempts_gsheet,
                               all_rr_attempts_moddate,
                               sheet = "full_sweep"))
  # 
  # tar_target(id_key,
  #            create_id_key(covid_ta2,
  #                         tagtable_covid_p1,
  #                         status,
  #                         p2_id_key,
  #                         SCORE_CVD2,
  #                         stitched_claims,
  #                         replication_qa,
  #                         reproduction_qa))
)
```

### Process Reproducibility

```{targets raw-pr}
list(
  # COS SCORE Data Google Drive - raw/process_reproducibility ----
  # https://drive.google.com/drive/folders/1y2X2jFBH7t6wDhviEqI85rbniYtm33AK
  
  # Original Author Outreach (OA_outreach_PR_coding)
  tar_target(oa_sheet,
             "1ke9auRcjFeFscpH53zM98dV6_ObpKckzX-YaXRzkuIw",
             cue = tar_cue("always")),
  
  # Process Reproducibility
  tar_target(pr_gsheet,
             "1E8LvpcuoUyVZV-EDqVPW_H1Cd-4OJCuR3Kl8HMJMVtI",
             cue = tar_cue("always")),
  tar_target(pr_data_raw,
             load_pr_data(pr_gsheet)),
  
  tar_target(pr_changelog_gsheet,
             "1zek9Lu-s303ZXs3B84h2vy-sJ1avOZSgpZEsna40pdA"),
  tar_target(pr_changelog_moddate,
             get_google_mod_date(pr_changelog_gsheet),
             cue = tar_cue("always")),
  tar_target(pr_input_changelog,
             load_changelog(pr_changelog_gsheet,
                            pr_changelog_moddate))
  
)
```

### Auxiliary Datasets

```{targets aux-data}
list(
  # Non-significant bushels
  # Coding out significant vs non-significant bushel claims
  tar_target(non_significant_bushels_gsheet,
             "1C89wRO_dZ1_qq9Ow0RpaWK2jWteloo9zPS9pW9VdbP0"),
  tar_target(non_significant_bushels_moddate,
             get_google_mod_date(non_significant_bushels_gsheet),
             cue = tar_cue("always")),
  tar_target(non_significant_bushels,
             read_google_sheet(non_significant_bushels_gsheet,
                               non_significant_bushels_moddate,
                               sheet = "claims")),
  
  # RR sourced 
  # All replication and reproduction projects that were matched with a team. 
  tar_target(rr_sourced_gsheet,
             "1EyUGgw8uGaCIP9nLXKh3IwqqU4DoAM4ZV6K5i1dOTHo"),
  tar_target(rr_sourced_moddate,
             get_google_mod_date(rr_sourced_gsheet),
             cue = tar_cue("always")),
  tar_target(rr_sourced,
             read_google_sheet(rr_sourced_gsheet,
                               rr_sourced_moddate,
                               sheet = "sourced",
                               drop_cols = "indicator")),
  
  # Never sourced
  # Reasons why non-matched papers were not plausible for replication
  tar_target(never_sourced_gsheet,
             "1OVfv_dDsfAeBOtx9-IaTNgPJv5-OFaHS4cK45aYsBpo"),
  tar_target(never_sourced_moddate,
             get_google_mod_date(never_sourced_gsheet),
             cue = tar_cue("always")),
  tar_target(never_sourced,
             read_google_sheet(never_sourced_gsheet,
                               never_sourced_moddate,
                               sheet = "never_sourced",
                               drop_cols = c("paper_link", "confidence"))),
  
  # Alternative Power Coding
  tar_target(ser_vs_traditional_gsheet,
             "1hGT5cEnadMVocvu-9LnfnFfZRZadYCjjPiFy41zwxWw"),
  tar_target(ser_vs_traditional_moddate,
             get_google_mod_date(ser_vs_traditional_gsheet),
             cue = tar_cue("always")),
  
  ## Traditional
  tar_target(traditional_power,
             read_google_sheet(ser_vs_traditional_gsheet,
                               ser_vs_traditional_moddate,
                               sheet = "traditional")),
  ## SER
  tar_target(ser_power,
             read_google_sheet(ser_vs_traditional_gsheet,
                               ser_vs_traditional_moddate,
                               sheet = "ser")),
  
  # Full Dates
  # Start and end dates of projects
  tar_target(full_dates_file,
             "1YHuWhvE_8tGFPe_L-yYfCYsZ7xBDRxSa"),
  tar_target(full_dates_moddate,
             get_google_mod_date(full_dates_file),
             cue = tar_cue("always")),
  tar_target(full_dates,
             read_google_csv(full_dates_file,
                             full_dates_moddate,
                             col_types = c("cccDDD"))),
  
  # Preregistration Indicators
  # Whether the original paper mentions preregistration
  tar_target(prereg_indicators_file,
             "1fOO4EoOkM8uswzgFczBlArsHbrf2KFeE"),
  tar_target(prereg_indicators_moddate,
             get_google_mod_date(prereg_indicators_file),
             cue = tar_cue("always")),
  tar_target(prereg_indicators,
             read_google_csv(prereg_indicators_file,
                             prereg_indicators_moddate,
                             col_types = c("clcd")))
)
```

## Processed Data

Replications/Reproductions variables data. QC'ed and merged.

```{targets processed-rr}
list(
  # Full replication dataset
  tar_target(rr_attempts_minted,
             update_attempts_minted(rr_attempts_minted_raw,
                                    rr_attempts_minted_changelog)),
  
  # Transform replication form data
  tar_target(replication_qa,
             transform_replication_qa(replication_qa_raw,
                                      rr_attempts_minted)),
  
  tar_target(repli_merged,
             merge_repli_input(rr_outcomes_dataset_p1,
                               replication_qa,
                               rr_reporting_checkin,
                               replication_cases,
                               effectsize_repli)),
  
  tar_target(repli_export,
             export_repli(repli_merged,
                          repli_input_changelog)),
  
  # Create replication analytic dataset
  tar_target(repli_outcomes,
             create_repli_analytic(repli_export,
                                   rr_attempts_minted,
                                   rr_statistics_output_p2,
                                   status,
                                   stitched_claims,
                                   effectsize_outcome,
                                   orig_outcomes,
                                   paper_metadata,
                                   repli_case_exclusions)),

  tar_target(repli_binary,
             calculate_repli_binary(repli_outcomes,
                                    orig_outcomes,
                                    paper_metadata)),
  
  # Reproduction targets ----
  # Transformed data from forms
  tar_target(repro_data_entry,
             transform_repro_input(reproduction_qa)),
  
  # Transform reproduction claims
  tar_target(rr_confrontations_repro_claim,
             transform_repro_claims(prereg_checkin_repro)),
  
  # Merge with additional cases
  tar_target(repro_merged,
             merge_repro(repro_data_entry,
                         reproduction_cases,
                         repro_vor)),
  
  # Update transformed data from forms
  tar_target(repro_export,
             update_repro(repro_merged,
                          p2_repro_input_changelog)),
  
  # Create repro supplement
  tar_target(repro_supplement_raw,
             transform_repro_outcomes(repro_export,
                                      orig_dataset,
                                      rr_confrontations_repro_claim)),
  
  tar_target(repro_supplement,
             update_repro_supplement(repro_supplement_raw,
                                     repro_supplement_changelog)),
  
  # Full reproduction dataset
  tar_target(repro_outcomes,
             create_repro_analytic(repro_export,
                                   repro_supplement))
  
)
```

Process reproducibility data. 

```{targets processed-pr}

list(
  
  tar_target(oa_changelog_file,
             "1mrH4mPCr6VUrOD8S08hhzD3jdcRjOnMPAF9XfZ0_vH4"),
  tar_target(oa_changelog_moddate,
             get_google_mod_date(oa_changelog_file),
             cue = tar_cue("always")),
  tar_target(oa_changelog,
             load_changelog(oa_changelog_file,
                            oa_changelog_moddate)),
  
  tar_target(oa_raw,
             load_process_oa(oa_sheet)),
  
  tar_target(oa_outreach,
             update_oa(oa_raw,
                       oa_changelog)),
  
  tar_target(pr_data_form,
             process_pr_data(pr_data_raw,
                           covid_ta2,
                           tagtable_covid_p1)),
           
  tar_target(pr_qc,
             update_pr(pr_data_form,
                       pr_input_changelog)),
  
  tar_target(pr_outcomes,
             create_pr_analytic(pr_qc, oa_outreach))
  
)

```


# Pipeline

Run the `{targets}` pipeline. Expected warnings:

1) orig_statistics_dataset_p1: One or more parsing issues
2) replication_qa: There was 1 warning in mutate
3) rr_confrontations_repro_claim: There was 1 warning in mutate.

```{r make}
tar_make()

targets::tar_meta(fields = warnings, complete_only = TRUE)
```

# Output

You can retrieve results from the `_targets/` data store using `tar_read()` or `tar_load()`.

The `targets` dependency graph shows the steps of the pipeline at a high level.

```{r visnetwork}
tar_visnetwork()
```
